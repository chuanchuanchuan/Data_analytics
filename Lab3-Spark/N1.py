import pyspark.sql
data = sc.textFile("/home/bigdatalab27/Downloads/mernis/data_dump_temp.sql")
data = data.filter(lambda line:line!='')
data = data.map(lambda lines:lines.split("\t"))
data = data.map(lambda line:(line[3],line[6]))
list_dataframe = sqlContext.createDataFrame(data,['last_name','gender'])
list_dataframe.registerTempTable("test")
result = sqlContext("""SELECT last_name,COUNT(*) as count FROM test WHERE gender = 'E' GROUP BY last_name ORDER BY count DESC""")
result.show()
result = sqlContext("""SELECT last_name,COUNT(*) as count FROM test WHERE gender = 'K' GROUP BY last_name ORDER BY count DESC""")
result.show()
